# Analyze Issue

Analyze an issue from the current project's issue tracker to gain deeper understanding of the problem, especially when the issue lacks details or requires codebase investigation.

## Usage

```
/oss-analyze-issue <issue>
```

**Arguments:**
- `<issue>` - Issue identifier: numeric ID (e.g., `42`), alphanumeric ID (e.g., `CAMEL-20410`), or full URL

## Instructions

### 1. Detect Project

Determine the current project by running:

```bash
git remote get-url origin
```

Match the output against the remote patterns to determine the project directory:
- `wanaku-ai/wanaku` -> `wanaku`
- `wanaku-ai/wanaku-capabilities-java-sdk` -> `wanaku-capabilities-java-sdk`
- `wanaku-ai/camel-integration-capability` -> `camel-integration-capability`
- `apache/camel` -> `camel-core`
- `apache/camel-quarkus` -> `camel-quarkus`
- `apache/camel-spring-boot` -> `camel-spring-boot`
- `apache/camel-kafka-connector` -> `camel-kafka-connector`
- `apache/camel-k` -> `camel-k`
- `hawtio/hawtio` -> `hawtio`
- `orpiske/ai-agents-oss-helper` -> `ai-agents-oss-helper`

If no match is found, stop and tell the user: "This project is not configured. Use `/oss-add-project` to register it."

Once matched, read the project's rule files from the corresponding subdirectory:
- `<project>/project-info.md` - Repository metadata, issue tracker, related repos
- `<project>/project-standards.md` - Build tools, commands, code style
- `<project>/project-guidelines.md` - Branching, commits, PR policies

### 2. Parse Input

Extract the issue ID from the argument based on the project's issue tracker type (from the project's `project-info.md`):

**GitHub projects:**
- If full URL: extract the number from the path
- If number only: use as-is

**Jira projects:**
- If full URL: extract the ID from the path
- If ID only: use as-is

### 3. Retrieve Issue Details

**GitHub projects:**

```bash
gh issue view <ISSUE_NUMBER> --repo <GITHUB_REPO> --json number,title,body,state,labels,comments
```

Also fetch comments for additional context:

```bash
gh issue view <ISSUE_NUMBER> --repo <GITHUB_REPO> --comments
```

**Jira projects:**

```bash
curl -s "https://issues.apache.org/jira/rest/api/2/issue/<ISSUE_ID>" | jq '{
  key: .key,
  summary: .fields.summary,
  description: .fields.description,
  status: .fields.status.name,
  priority: .fields.priority.name,
  type: .fields.issuetype.name,
  components: [.fields.components[].name],
  labels: .fields.labels
}'
```

**Rate Limiting:** For Jira, make ONE request only.

### 4. Analyze Issue Content

From the retrieved information, identify:

1. **Problem Statement** - What is the user reporting?
2. **Symptoms** - What behavior is observed?
3. **Expected Behavior** - What should happen instead?
4. **Missing Information** - What details are lacking?
5. **Keywords** - Error messages, component names, feature names

### 5. Investigate the Codebase

Based on keywords and context from the issue:

#### Primary Repository
Search the current codebase for relevant code:
- Error messages mentioned in the issue
- Component or feature names
- Related functionality

#### Related Repositories

Check the project's `project-info.md` for the **Related repositories** field. Only investigate related repos when they are listed and the issue might involve them.

For each relevant related repository, clone if needed:
```bash
gh repo clone <RELATED_REPO> /tmp/<repo-name>
```

### 6. Build Understanding

Synthesize findings into:

1. **Root Cause Hypothesis** - What might be causing the issue?
2. **Affected Components** - Which files/modules are involved?
3. **Related Code Paths** - Trace the execution flow
4. **Potential Solutions** - Possible approaches to fix

### 7. Present Analysis

Provide a structured analysis report to the user:

```markdown
> :robot: **Note:** This analysis was generated by a coding agent and requires manual verification. The hypotheses and suggestions below should be reviewed by a human before taking action.

## Issue Analysis: #<ID>

### Summary
<Brief description of the issue>

### Problem Understanding
<What the issue is about, including any inferred details>

### Missing Information
<What details would help clarify the issue>

### Codebase Investigation

#### Relevant Files
- `path/to/file1.java` - <why it's relevant>
- `path/to/file2.java` - <why it's relevant>

#### Related Repositories
<Only include if project-info.md lists related repositories>
- [ ] <repo name> - <relevant/not relevant>

### Root Cause Hypothesis
<What might be causing the problem>

### Suggested Next Steps
1. <action 1>
2. <action 2>

### Questions for Issue Reporter
- <question 1>
- <question 2>
```

### 8. Suggest Follow-up Actions

Based on the analysis, recommend:

- **If issue needs more info**: Suggest questions to ask the reporter
- **If ready to fix**: Direct to `/oss-fix-issue <ID>`

### 9. Constraints

You MUST:
- Include the :robot: disclaimer note at the beginning of every analysis report
- Read the issue thoroughly before investigating code
- Search across all relevant repositories when listed in the project's `project-info.md`
- Present findings clearly and structured
- Identify what information is missing
- Suggest concrete next steps

You MUST NOT:
- Make changes to any code (analysis only)
- Close or modify any issues
- Make assumptions without stating them as hypotheses
- Skip investigating related repositories when relevant
- For Jira: make multiple API requests

### 10. Acceptance Criteria

- Issue is fully analyzed with structured report
- Relevant code sections are identified
- Root cause hypothesis is provided (if possible)
- Clear next steps are recommended
- Missing information is identified for follow-up
